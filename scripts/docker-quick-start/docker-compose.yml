version: '2'

services:
  sofa-dashboard-quick-start:
    image: sofastack/sofa-dashboard-web:1.0.0-SNAPSHOT
    container_name: sofa-dashboard-quick-start
    depends_on:
      - sofa-dashboard-db
      - sofa-dashboard-zk
      - apollo-quick-start
    ports:
      - "8080:8080"
    links:
      - sofa-dashboard-zk
      - sofa-dashboard-db
      - apollo-quick-start

  apollo-quick-start:
    image: nobodyiam/apollo-quick-start
    container_name: apollo-quick-start
    depends_on:
      - sofa-dashboard-db
    ports:
      - "18080:8080"
      - "18070:8070"
    volumes:
      - ./apollo:/sofa-apollo-patch
    links:
      - sofa-dashboard-db
    command:
      /sofa-apollo-patch/apollo-sofa-dashboard-entrypoint.sh

  sofa-dashboard-zk:
    image: zookeeper:3.4.14
    container_name: sofa-dashboard-zk
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=0.0.0.0:2888:3888
    ports:
      - "2181:2181"

  sofa-dashboard-db:
    image: mysql:5.7
    container_name: sofa-dashboard-db
    environment:
      TZ: Asia/Shanghai
      MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    depends_on:
      - sofa-dashboard-dbdata
    ports:
      - "3306:3306"
    volumes:
      - ../sql:/docker-entrypoint-initdb.d
    volumes_from:
      - sofa-dashboard-dbdata

  sofa-dashboard-dbdata:
    image: alpine:latest
    container_name: sofa-dashboard-dbdata
    volumes:
      - /var/lib/mysql
